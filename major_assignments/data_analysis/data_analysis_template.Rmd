---
title: "Data Analysis Project"
author: "michael purdie"
date: "11/14/21"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, we are working with the [Washington Post police shooting database](https://github.com/washingtonpost/data-police-shootings) and the [Washington Post homicides database.](https://github.com/washingtonpost/data-homicides)

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}
#essential libraries
library(tidyverse)
library(tidycensus)
library(sf)
library(tigris)
#potential libraries 
library(janitor)
library(lubridate)

#API Census key
census_api_key("b559c55dc9a86baaa9ab42174d2fa978a618dff1")

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}
#Load required data
police_shootings <- read_csv("data/data-police-shootings-master/fatal-police-shootings-data.csv")

#cleaning and organizing
#geocoded data
data1 <- read_rds("data/geocoded_results_500.rds")
data2 <- read_rds("data/geocoded_results_1000.rds")
data3 <- read_rds("data/geocoded_results_1500.rds")
data4 <- read_rds("data/geocoded_results_2000.rds")
data5 <- read_rds("data/geocoded_results_2500.rds")
data6 <- read_rds("data/geocoded_results_3000.rds")
data7 <- read_rds("data/geocoded_results_3500.rds")
data8 <- read_rds("data/geocoded_results_4000.rds")
data9 <- read_rds("data/geocoded_results_4500.rds")
data10 <-read_rds("data/geocoded_results_5000.rds")
data11 <-read_rds("data/geocoded_results_5500.rds")
data12 <-read_rds("data/geocoded_results_6000.rds")
data13 <-read_rds("data/geocoded_results_6410.rds")

#join geocoded datasets 
shootings_w_geoid <- rbind(data1,data2,data3,data4,data5,data6,data7,data8,data9,data10,data11,data12,data13)

#pulling info from census
census_data <- get_acs(geography = "tract",
                       variables = c(population = "B01001_001", 
                                     median.gross.rent = "B25064_001",
                                     median.household.income = "B19013_001",
                                     rent.burden = "B25071_001",
                                     white = "B03002_003",
                                     af.am = "B03002_004",
                                     hispanic = "B03002_012",
                                     am.ind = "B03002_005",
                                     asian = "B03002_006",
                                     nh.pi = "B03002_007",
                                     multiple = "B03002_009",
                                     other = "B03002_008"),
                       state = c("AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA","KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT","VA","WA","WV","WI","WY"), 
                       year = 2019)

#PIVOT
census_data <- pivot_wider(census_data, names_from = variable, names_sep = ".", values_from = c(estimate, moe)) 

#rename column
census_data <- rename(census_data, census_tracts_geoid = GEOID)

#join
shootings_w_acs <- shootings_w_geoid  %>%
  left_join(census_data, by=c("census_tracts_geoid"))

new_shootings_w_acs <- read_rds("data/new_shootings_w_acs.rds")


```

#Brief Analysis of Loaded Data
In looking at the police shootings data, everything looks relatively clean, so we don't foresee having to do any cleaning. We're choosing to focus on the geography of police shootings, so we need to use Census data in order to figure out where exactly these police shootings are happening, and if there are certain neighborhoods (ex: majority-minority or low income) that are more affected by police shootings. We'll likely need to form some kind of relationship between the lat/long coordinates in this dataset and data from Census tracts.

### Race Analysis

``` {r}
## first looking at data for highest percentage african american tracts: 
black_neighborhood_shootings <- new_shootings_w_acs %>%
  mutate(
    pct_black = (estimate.af.am/estimate.population) * 100)  %>%
    filter(pct_black > 50) %>%
  select(name, age, date, race, city, state, NAME, pct_black) %>%
  arrange(desc(pct_black))

## 682 shootings in neighborhoods that are majority black in a dataset of 6409

(682/ 6410) * 100
## interesting --> 10.63 percent of the total shootings were in majority black neighborhoods. 

## how many of those were black people? 
black_neighborhood_shootings %>%
  filter(race == "B") %>%
  summarize (
    count = n() 
  ) %>%
  as_tibble()

## 508 of those are black 
(508 / 682) * 100 
  = 74.4868 percent of the shootings in Black neighborhoods

## where were the most shootings? 
    #tract level
black_neighborhood_shootings %>%
  group_by(NAME) %>%
   summarize(
   count = n() 
  ) %>%
  arrange(desc(count))
   ## Duval County, Florida --> Jacksonville

    #city level
black_neighborhood_shootings %>%
  group_by(city) %>%
   summarize(
   count = n() 
  ) %>%
  arrange(desc(count))
  ## on the city level, most shootings are in Chicago, and many of them were in major cities 

## racial breakdown of all of the shootings
shootings_w_acs %>%
   group_by(race) %>%
   summarize(
   count = n() 
  ) %>%
  arrange(desc(count))
  ##overall, white people made up more of the total shootings. 

## breakdown in majority black neighborhoods
black_neighborhood_shootings %>%
  group_by(race) %>%
   summarize(
   count = n() 
  ) %>%
  arrange(desc(count))
  ##black people made up the majority
  
## white people shot in majority white neighborhoods
white_neighborhood_shootings_white <- new_shootings_w_acs %>%
filter(race == "W", estimate.white > estimate.af.am + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
white_neighborhood_shootings_white
  ##2573 people

## black people shot in majority white neighborhoods
white_neighborhood_shootings_black <- new_shootings_w_acs %>%
filter(race == "B", estimate.white > estimate.af.am + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
white_neighborhood_shootings_black
  ##709 people

## total people shot in majority white neighborhoods
majority_white_neighborhood_shootings <- new_shootings_w_acs %>%
filter(estimate.white > estimate.af.am + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
majority_white_neighborhood_shootings
  ##4856 people

2573/4856 = 0.52986*100 
    = 52.986% of people shot in majority white neighborhoods are white. 

709/4856 = 0.1460049*100
    = 14.6% of people shot in majority white neighborhoods are black. 

## black people shot in majority black neighborhoods
black_neighborhood_shootings_black <- new_shootings_w_acs %>%
filter(race == "B", estimate.af.am > estimate.white + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
black_neighborhood_shootings_black
  ##663 people

## white people shot in majority black neighborhoods
black_neighborhood_shootings_white <- new_shootings_w_acs %>%
filter(race == "W", estimate.af.am > estimate.white + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
black_neighborhood_shootings_white
  ##144 people

## total people shot in majority black neighborhoods
majority_black_neighborhood_shootings <- new_shootings_w_acs %>%
filter(estimate.af.am > estimate.white + estimate.am.ind + estimate.asian + estimate.nh.pi + estimate.other)
majority_black_neighborhood_shootings
  ##1029 people

144/1029 = 0.1399417*100 
    = 13.4% of people shot in majority black neighborhoods are white. 

663/1029 = 0.6443149*100
    = 64.4% of people shot in majority black neighborhoods are black. 

```
### Income Analysis

``` {r}
## income breakdown !! 
    ## Pew Research Center defines low income households as those earning below $48,500 
    
## general breakdown first:
low_income_shootings <- new_shootings_w_acs %>%
  filter(estimate.median.household.income < 48500)

low_income_shootings %>% 
   summarize(
   count = n() 
  ) 
  ## 2924 shootings out of 6409 were in low-income neighborhoods 

(2924/6409) * 100
  = 45.6% of shootings were in low-income neighborhoods.

## where are the specific places:
low_income_shootings %>%
  group_by(NAME) %>%
   summarize(
   count = n() 
  ) %>%
  arrange(desc(count))
  ##none of these seem to be significant

## white people shot in majority low-income neighborhoods
low_income_neighborhood_shootings_white <- new_shootings_w_acs %>%
filter(race == "W", estimate.median.household.income < 48500)
low_income_neighborhood_shootings_white
  ##1108 people

## black people shot in majority low-income neighborhoods
low_income_neighborhood_shootings_black <- new_shootings_w_acs %>%
filter(race == "B", estimate.median.household.income < 48500)
low_income_neighborhood_shootings_black
  ##865 people

## total people shot in majority low-income neighborhoods
majority_low_income_neighborhood_shootings <- new_shootings_w_acs %>%
filter(estimate.median.household.income < 48500)
majority_low_income_neighborhood_shootings
  ##2924 people

1108/2924 = 0.378933*100 
    = 37.9% of people shot in majority low-income neighborhoods are white. 

865/2924 = 0.2958276*100
    = 29.6% of people shot in majority low-income neighborhoods are black. 

```

### IGNORE THIS LOL
### Question 3

* **Question text**: Are there patterns regarding race and instances in which the victim was armed with a toy weapon? 

* **Analysis summary**: 

```{r}
police_shootings_by_race <- police_shootings %>%
  group_by(race) %>%
  summarize(
    total_per_race = n()
  ) 
    
police_shootings_armed_with_toy <- police_shootings %>%
  filter(str_detect(armed, "toy")) %>%
  group_by(race) %>%
  summarize(
    total_armed_with_toy = n()
  ) 

police_shootings_armed_with_toy_per_race <- police_shootings_by_race %>%
  left_join(police_shootings_armed_with_toy) %>%
  mutate(total_armed_with_toy = replace_na(total_armed_with_toy,0)) %>%
  mutate(percent_armed_with_toy_per_race = total_armed_with_toy/total_per_race*100) %>%
  arrange(desc(percent_armed_with_toy_per_race))

police_shootings_by_race
police_shootings_armed_with_toy
police_shootings_armed_with_toy_per_race

#not finished, trying to figure out if i need to left_join bc ungroup() wouldnt work
```