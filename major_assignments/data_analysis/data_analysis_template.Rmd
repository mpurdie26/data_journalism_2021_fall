---
title: "Data Analysis Project"
author: "michael purdie"
date: "11/14/21"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, we are working with the [Washington Post police shooting database](https://github.com/washingtonpost/data-police-shootings) and the [Washington Post homicides database.](https://github.com/washingtonpost/data-homicides)

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}
#essential libraries
library(tidyverse)
library(tidycensus)
library(sf)
library(tigris)
#potential libraries 
library(janitor)
library(lubridate)

#API Census key
census_api_key("b559c55dc9a86baaa9ab42174d2fa978a618dff1")

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}
#Load required data
police_shootings <- read_csv("data/data-police-shootings-master/fatal-police-shootings-data.csv")
#Load potential data
homicides <- read_csv("data/data-homicides-master/homicide-data.csv")

#Load Census data and county data from Tigris 
states <- states()
county_populations <- get_acs(geography = "county", 
              variables = c(population = "B01001_001"),
              geometry = TRUE)

#Clean required data
#excludes territories from counties dataset
counties <- counties %>%
  filter(STATEFP < "57")
#May need further cleaner later on during analysis
```

#Brief Analysis of Loaded Data
In looking at the police shootings data, everything looks relatively clean, so we don't foresee having to do any cleaning. We're choosing to focus on the geography of police shootings, so we need to use Census data in order to figure out where exactly these police shootings are happening, and if there are certain neighborhoods (ex: majority-minority or low income) that are more affected by police shootings. We'll likely need to form some kind of relationship between the lat/long coordinates in this dataset and data from Census tracts.
 
#Data Dictionary
Will get back to this at the end once we have a cleaned and finalized dataset. 

### Analysis

* **Question text**: Are there geographical patterns regarding police shootings? Do majority Black areas have a higher rate of total police shootings per total population?

* **Analysis summary**: We probably won't use this question in the final project, just using it to visualize the data.

``` {r}
ggplot() + 
  geom_sf(data=states) +
  geom_point(data=police_shootings, aes(x=longitude, y = latitude)) +
  geom_sf(data=police_shootings, aes(geometry=geometry)) +
  theme_minimal() 

```

### Question 2

* **Question text**: testing geocode join

* **Analysis summary**: 

``` {r}
read_rds("data/geocoded_results_1000.rds")
read_rds("data/geocoded_results_1500.rds")
read_rds("data/geocoded_results_2000.rds")
read_rds("data/geocoded_results_2500.rds")
read_rds("data/geocoded_results_3000.rds")
read_rds("data/geocoded_results_3500.rds")
read_rds("data/geocoded_results_4000.rds")
read_rds("data/geocoded_results_4500.rds")

test_census <- get_acs(geography = "tract",
                       variables = c(population = "B01001_001", 
                                     median.gross.rent = "B25064_001",
                                     median.household.income = "B19013_001",
                                     rent.burden = "B25071_001",
                                     white = "B03002_003",
                                     af.am = "B03002_004",
                                     hispanic = "B03002_012",
                                     am.ind = "B03002_005",
                                     asian = "B03002_006",
                                     nh.pi = "B03002_007",
                                     multiple = "B03002_009",
                                     other = "B03002_008"),
                       state = "MD",
                       year = 2019)

pivot_wider(test_census, names_from = variable, names_sep = ".", values_from = c(estimate, moe))

```

### Question 3

* **Question text**: Are there patterns regarding race and instances in which the victim was armed with a toy weapon? 

* **Analysis summary**: 

```{r}
police_shootings_by_race <- police_shootings %>%
  group_by(race) %>%
  summarize(
    total_per_race = n()
  ) 
    
police_shootings_armed_with_toy <- police_shootings %>%
  filter(str_detect(armed, "toy")) %>%
  group_by(race) %>%
  summarize(
    total_armed_with_toy = n()
  ) 

police_shootings_armed_with_toy_per_race <- police_shootings_by_race %>%
  left_join(police_shootings_armed_with_toy) %>%
  mutate(total_armed_with_toy = replace_na(total_armed_with_toy,0)) %>%
  mutate(percent_armed_with_toy_per_race = total_armed_with_toy/total_per_race*100) %>%
  arrange(desc(percent_armed_with_toy_per_race))

police_shootings_by_race
police_shootings_armed_with_toy
police_shootings_armed_with_toy_per_race

#not finished, trying to figure out if i need to left_join bc ungroup() wouldnt work
```