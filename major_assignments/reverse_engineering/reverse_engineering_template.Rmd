---
title: "Reverse Engineering Project"
author: "michael purdie"
date: "10/10/21"
output:
  html_document:
    theme: cerulean
    highlight: pygments
    toc: true
    toc_float:
      collapsed: true
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

In this notebook, we are reverse engineering the story, [Over a Dozen Black and Latino Men Accused a Cop of Humiliating, Invasive Strip Searches. The NYPD Kept Promoting Him.](https://www.propublica.org/article/over-a-dozen-black-and-latino-men-accused-a-cop-of-humiliating-invasive-strip-searches-the-nypd-kept-promoting-him)

## Load libraries

Loading required libraries for this analysis.

```{r echo=FALSE, message=FALSE}

#load tidyverse
library(tidyverse)
#load janitor
library(janitor)
#load lubridate
library(lubridate)
#load readxl
library(readxl)

```

## Load and Cleaning Data

In this section, describe the source of the data, write a basic data dictionary for data you are working with, and discuss any caveats or issues you discovered working with this data. 

```{r}
# Load required data
allegations <- read_csv("data/CCRB-Complaint-Data_202007271729/allegations_202007271729.csv")
allegation_description <- read_excel("data/CCRB-Complaint-Data_202007271729/CCRB Data Layout Table.xlsx")

#cleaning data
cleaned_allegations <- allegations %>%
  #new cleaned board_disposition column
  mutate(
    cleaned_board_disposition = case_when(
      str_detect(board_disposition, "^S") ~ "Substantiated",
      TRUE ~ board_disposition
    )
  ) %>%
  #new column that identifies officers that are currently a higher rank than captain
  mutate(
    rank_above_captain = if_else(
      rank_now == 'Deputy Inspector' | 
      rank_now == 'Inspector' | 
      rank_now == 'Deputy Chief' | 
      rank_now == 'Assistant Chief' | 
      rank_now == 'Bureau Chief' | 
      rank_now == 'Police Comissioner' | 
      rank_now == 'Chiefs and other ranks', "Yes", "No")
  )


```

## Sentences to Engineer
In this notebook, we are reverse engineering five sentences from the story.

### Sentence 1

* **Sentence text**: “A dozen of those high-ranking officers have three or more complaints with substantiated allegations; 10 are white. Five have reached the rank of deputy inspector, the lowest promoted at the commissioner’s discretion; all are white.”

* **Analysis summary**: My analysis did not confirm the results from the article, but I believe this is due to the fact that the data has been updated since. I found that there were 25 high-ranking officers with three or more complaints, not a dozen, and 17 were White, not 10. Also, there were 11 high-ranking officers with three or more complaints that are now a deputy inspector, and they are not all White. In regard to format, I narrowed down the data to the appropriate requirements, then grouped and summarized to obtain the number of total complaints for each officer. Finally, I filtered for officers with more than two complaints.

```{r}
#High-ranking officers with three or more complaints
cleaned_allegations %>%
  filter(rank_above_captain == "Yes") %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  group_by(unique_mos_id, first_name, last_name, rank_now, mos_ethnicity) %>%
  summarize(
    total_allegations = n()
  ) %>%
    ungroup() %>%
    filter(total_allegations > 2) %>%
    arrange(desc(total_allegations)) %>%
    summarize(
          total_high_ranking = n()
        )

#White high-ranking officers with three or more complaints
cleaned_allegations %>%
  filter(rank_above_captain == "Yes") %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  filter(mos_ethnicity == "White") %>%
  group_by(unique_mos_id, first_name, last_name, rank_now, mos_ethnicity) %>%
    summarize(
      total_allegations = n()
    ) %>%
    ungroup() %>%  
    filter(total_allegations > 2) %>%
      arrange(desc(total_allegations)) %>%
      summarize(
        total_high_ranking_white = n()
       )


#High-ranking officers with three or more complaints that have reached the rank of deputy inspector
cleaned_allegations %>%
  filter(rank_now == "Deputy Inspector") %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  group_by(unique_mos_id, first_name, last_name, rank_now, mos_ethnicity) %>%
    summarize(
      total_allegations = n()
    ) %>%
      ungroup() %>%
      filter(total_allegations > 2) %>%
      arrange(desc(total_allegations)) %>%
      summarize(
        total_deputy_inspector = n()
  )

```

### Sentence 2

* **Sentence text**: “Eighty-six of the roughly 420 officers in the department who currently hold a rank above captain — running precincts and other large commands and overseeing hundreds of officers — have tallied at least one misconduct allegation that was substantiated by the CCRB, meaning that investigators amassed enough evidence of offenses, ranging from bad language to pistol whippings, to say that they happened and broke patrol guidelines. The most common involved improper property entries and searches.”

* **Analysis summary**: In this section of code, we began by looking into the allegations by rank, filtering by the ranks of "Captain", "Deputy Inspector","Inspector", Deputy Chief", Assistant Chief", "Bureau Chief", "Police Commissioner" and "Chiefs and other ranks". Finally, we filtered the data by substantiated allegations. This allowed us to reach the conclusion that eighty-six of around 420 officers in the department who hold a rank above captain have had at least one misconduct allegation that was substantiated by the CCRB. 

```{r}
#number of high-ranking officers with at least one substantiated misconduct allegation
cleaned_allegations %>%
  filter(rank_above_captain == "Yes") %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  group_by(unique_mos_id, first_name, last_name, rank_now, mos_ethnicity) %>%
  summarize(
    total_allegations = n()
  ) 

#most common misconduct allegation
cleaned_allegations %>%
  filter(rank_above_captain == "Yes") %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  group_by(allegation) %>%
  summarize(
    count = n()
  ) %>%
  arrange(desc(count))
```

### Sentence 3

* **Sentence text**: “Of at least 77 allegations made against him in 26 separate CCRB complaints, 29 were unsubstantiated; five were “unfounded,” meaning investigators concluded the incident never took place; and 27 were “exonerated,” meaning the conduct fell within patrol guidelines.”

* **Analysis summary**: In order to uncover the data used for this sentence of the article, we created the oject 'cchrisallegations' and filtered by last name 'Mccormack' and first name 'Christophe'. We grouped the data for Christopher McCormack by 'unique_mos_id', 'first_name', 'last_name' and 'allegation' and this returned 26 separate allegations. After this, we further grouped the data by 'clean_disposition' and were able to organize the allegations made against McCormack by unsubstantiated allegations, unfounded allegations and exonerated allegations. 

```{r}
#make new dataset that shows only Christopher McCormack's allegations
#Christopher McCormack's unique_mos_id is 18589
mccormack_allegations <- cleaned_allegations %>%
  filter(unique_mos_id == 18589)

#number of unsubstantiated allegations for Christopher McCormack
mccormack_allegations %>% 
  filter(cleaned_board_disposition == "Unsubstantiated") %>%
  group_by(unique_mos_id) %>%
  summarize(
    unsubstantiated_count = n()
  )

#unfounded claims were not entered into the dataset

#number of exonerated allegations for Christopher McCormack
mccormack_allegations %>% 
  filter(cleaned_board_disposition == "Exonerated") %>%
  group_by(unique_mos_id) %>%
  summarize(
    exonerated_count = n()
  )

```

### Sentence 4

* **Sentence text**: “But many of the officers also said that it’s possible to be an effective cop without so many complaints. An overwhelming majority of the city’s 36,000 officers do not have a single substantiated complaint on their records; only 1 in 9 does.”

* **Analysis summary**: For this sentence, we began by creating an entirely new data set that would return the total number of officers with at least one substantiated complaint. We created an object called 'officers_with_complaints' and filtered by 'substantiated' allegations and used distinct to return only the 'unique_mos_id', 'first_name', 'last_name' and 'rank_now' columns. After this, we divided the number of officers with at least one substantiated complaint by the total number of officers, in order to conclude that a majority of the city's 36,000 officers do not have a substantiated complaint on their record, only 1 in 9 does. 

```{r}
#make new dataset that gives total number of officers with at least one substantiated complaints
officers_with_complaints <- cleaned_allegations %>%
  filter(cleaned_board_disposition == "Substantiated") %>%
  distinct(unique_mos_id, first_name, last_name, rank_now)

#number of officers with at least one substantiated complaint/total number of officers
officers_with_complaints %>%
    summarize(
      total = n()/36000
    ) 

#1 in 9 = .1111

```

### Sentence 5

* **Sentence text**: There isn't really a sentence from the story, but I'd like you to answer this question: The story focused on Christopher McCormack. Use data analysis to justify that decision. Why does he stand out as newsworthy, from all of the people they could have selected? Why, do you think, did the reporters single him out for an in-depth story. Write code to support your argument.

* **Analysis summary**: In our last section, we created code to show why Christopher McCormack stands out as newsworthy. The reporters singled him out as newsworthy because, although he had similar allegations to many other officers, his accusations by Black and Latino men of invasive, humiliating searches were far more significant. Reporters wrote that he was accused of pulling own their pants in public, exposing their genitals and using inappropriate methods to search for drugs. In our code, we began by filtering the cleaned allegations by "rank_above_captain= "Yes" and grouping by 'unique_mos_id', 'first_name', 'last_name', 'rank_now', and 'mos_ethnicity'. This returned results that showed the depth of the claims made against McCormack. 

```{r}
# Put code to reverse engineer sentence here
cleaned_allegations %>%
  filter(rank_above_captain == "Yes") %>%
 group_by(unique_mos_id, first_name, last_name, rank_now, mos_ethnicity) %>%
 summarize(
    total_allegations = n()
  ) %>%
  arrange(desc(total_allegations))

```

-30-